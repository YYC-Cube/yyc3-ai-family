# YYC³ AI-Family - 提交前严格审核清单

> **严格级别**: 🔴 **P0 - 强制执行**
>
> **审核原则**: 宁可错过一次提交，不可引入一个Bug
>
> **执行频率**: 每次Git commit前必须执行

---

## 📋 审核概览

| 审核类别 | 优先级 | 检查项数量 | 通过标准 |
|---------|--------|-----------|----------|
| **代码质量** | 🔴 P0 | 12项 | 100%通过 |
| **功能完整性** | 🔴 P0 | 8项 | 100%通过 |
| **文档完整性** | 🟡 P1 | 6项 | 100%通过 |
| **安全性** | 🔴 P0 | 5项 | 100%通过 |
| **性能** | 🟡 P1 | 4项 | 100%通过 |
| **用户体验** | 🟡 P1 | 5项 | 100%通过 |
| **兼容性** | 🟡 P1 | 4项 | 100%通过 |
| **品牌一致性** | 🟢 P2 | 3项 | 100%通过 |

**总计**: 47项检查，必须全部通过方可提交

---

## 🔴 P0 - 强制审核项（必须全部通过）

### 1. 代码质量审核 (12项)

#### 1.1 TypeScript类型安全
- [ ] **无`any`类型**: 检查是否使用`any`类型，必须使用具体类型
  ```bash
  grep -r ": any" src/ --include="*.ts" --include="*.tsx"
  ```
- [ ] **无隐式any**: 所有参数必须有明确类型注解
- [ ] **接口完整**: 所有对象必须定义明确的TypeScript接口
- [ ] **枚举使用**: 使用`enum`替代魔法字符串/数字

#### 1.2 代码规范
- [ ] **ESLint通过**: 运行`pnpm run lint`，0个错误
  ```bash
  pnpm run lint
  ```
- [ ] **Prettier格式化**: 运行`pnpm run format`，无格式差异
  ```bash
  pnpm run format
  ```
- [ ] **命名规范**: 遵循camelCase/PascalCase/kebab-case规范
  - 组件: PascalCase (SettingsModal)
  - 函数/变量: camelCase (handleSave)
  - 常量: UPPER_SNAKE_CASE (API_ENDPOINT)
  - 文件: kebab-case (settings-modal.tsx)

#### 1.3 测试覆盖
- [ ] **单元测试**: 新增功能必须有单元测试
- [ ] **测试通过**: 运行`pnpm run test`，所有测试通过
  ```bash
  pnpm run test
  ```
- [ ] **覆盖率达标**: 核心模块测试覆盖率 ≥ 80%
- [ ] **Edge Case**: 测试边界条件和异常情况

#### 1.4 依赖管理
- [ ] **无未使用依赖**: 检查package.json中未使用的依赖
- [ ] **依赖版本**: 所有依赖必须指定版本号
- [ ] **安全扫描**: 运行`npm audit`，无高危漏洞
  ```bash
  npm audit --production
  ```
- [ ] **无重复依赖**: 检查是否有重复的依赖包

### 2. 功能完整性审核 (8项)

#### 2.1 功能实现
- [ ] **需求对齐**: 所有PR/issue中列出的需求都已实现
- [ ] **功能测试**: 手动测试所有新增/修改的功能
- [ ] **回归测试**: 确保现有功能未被破坏
- [ ] **边界条件**: 测试空值、null、undefined等边界情况

#### 2.2 错误处理
- [ ] **错误捕获**: 所有异步操作必须有try-catch
- [ ] **错误提示**: 用户友好的错误提示信息
- [ ] **日志记录**: 关键错误必须记录到日志
- [ ] **降级方案**: 关键功能失败时有降级方案

#### 2.3 状态管理
- [ ] **状态一致**: Zustand store状态更新逻辑正确
- [ ] **副作用隔离**: 异步操作不污染其他状态
- [ ] **状态清理**: 组件卸载时清理订阅和定时器

### 3. 安全性审核 (5项)

#### 3.1 输入验证
- [ ] **XSS防护**: 所有用户输入必须经过转义/过滤
- [ ] **类型验证**: 表单输入必须验证类型和格式
- [ ] **长度限制**: 所有输入字段必须有长度限制
- [ ] **SQL注入防护**: 数据库查询使用参数化查询

#### 3.2 敏感信息
- [ ] **无硬编码密钥**: 检查代码中是否有API密钥/Token
  ```bash
  grep -r "sk-" "api_key" "token" src/ --include="*.ts" --include="*.tsx"
  ```
- [ ] **环境变量**: 敏感配置必须使用环境变量
- [ ] **Git忽略**: `.gitignore`必须包含敏感文件
  ```
  .env
  .env.local
  *.key
  ```

---

## 🟡 P1 - 重要审核项（必须全部通过）

### 4. 文档完整性审核 (6项)

#### 4.1 代码文档
- [ ] **文件头注释**: 所有新文件必须包含文件头注释
  ```typescript
  /**
   * @file 文件名
   * @description 文件描述
   * @author YYC³ Team
   * @version 1.0.0
   */
  ```
- [ ] **函数注释**: 复杂函数必须有JSDoc注释
  ```typescript
  /**
   * 函数描述
   * @param param1 参数1描述
   * @returns 返回值描述
   */
  ```
- [ ] **复杂逻辑注释**: 复杂业务逻辑必须添加注释说明

#### 4.2 用户文档
- [ ] **README更新**: 如有重大功能更新，必须更新README.md
- [ ] **CHANGELOG更新**: 记录版本变更
  ```markdown
  ## [0.33.2] - 2026-02-25
  ### Added
  - 新功能描述
  ### Fixed
  - 修复的问题
  ```
- [ ] **技术文档**: 复杂功能必须有技术决策文档
- [ ] **API文档**: 新增API必须有接口文档

#### 4.3 中文本地化
- [ ] **中文文本**: 所有用户界面文本必须是中文
- [ ] **i18n完整性**: 新增文本必须添加到i18n配置
- [ ] **术语一致**: 同一概念使用相同术语

### 5. 性能审核 (4项)

#### 5.1 渲染性能
- [ ] **避免重渲染**: 使用React.memo/useMemo/useCallback优化
- [ ] **虚拟滚动**: 长列表必须使用虚拟滚动
- [ ] **懒加载**: 图片/组件按需加载
- [ ] **代码分割**: 大型组件使用动态import

#### 5.2 资源优化
- [ ] **图片优化**: 图片格式使用WebP，适当压缩
- [ ] **包体积**: 构建后检查bundle大小，无异常增长
  ```bash
  pnpm run build
  du -sh dist/*
  ```
- [ ] **Tree Shaking**: 确保未使用代码被移除
- [ ] **缓存策略**: 合理使用浏览器缓存和CDN

### 6. 用户体验审核 (5项)

#### 6.1 可访问性
- [ ] **键盘导航**: 所有交互支持键盘操作
- [ ] **ARIA标签**: 语义化HTML，添加ARIA属性
- [ ] **对比度**: 文字与背景对比度 ≥ 4.5:1
- [ ] **屏幕阅读器**: 重要内容可被屏幕阅读器访问

#### 6.2 响应式设计
- [ ] **移动端适配**: 320px-768px屏幕正常显示
- [ ] **平板适配**: 768px-1024px屏幕正常显示
- [ ] **桌面适配**: 1024px+屏幕正常显示
- [ ] **触摸友好**: 触摸目标尺寸 ≥ 44x44px

#### 6.3 用户反馈
- [ ] **加载状态**: 异步操作显示加载指示器
- [ ] **错误提示**: 操作失败显示明确的错误信息
- [ ] **成功反馈**: 操作成功显示确认提示
- [ ] **空状态**: 列表为空时显示友好提示

### 7. 兼容性审核 (4项)

#### 7.1 浏览器兼容
- [ ] **Chrome**: 最新2个版本测试通过
- [ ] **Safari**: 最新2个版本测试通过
- [ ] **Firefox**: 最新2个版本测试通过
- [ ] **Edge**: 最新2个版本测试通过

#### 7.2 设备兼容
- [ ] **iOS**: iOS 14+测试通过
- [ ] **Android**: Android 10+测试通过
- [ ] **Mac**: macOS 12+测试通过
- [ ] **Windows**: Windows 10+测试通过

---

## 🟢 P2 - 建议审核项（建议全部通过）

### 8. 品牌一致性审核 (3项)

- [ ] **视觉风格**: 遵循赛博朋克设计语言
- [ ] **色彩规范**: 使用统一的YYC³色彩体系
- [ ] **品牌元素**: 包含"人机协同·智爱同行"理念

---

## 🚀 审核执行流程

### 步骤1: 本地自检（5分钟）
```bash
# 1. 代码质量检查
pnpm run lint
pnpm run format

# 2. 类型检查
pnpm run type-check

# 3. 测试检查
pnpm run test

# 4. 安全检查
npm audit --production

# 5. 构建检查
pnpm run build
```

### 步骤2: 功能验证（10分钟）
- [ ] 手动测试所有新增功能
- [ ] 验证回归测试
- [ ] 检查移动端响应式
- [ ] 验证多浏览器兼容性

### 步骤3: 文档审核（5分钟）
- [ ] 检查README是否需要更新
- [ ] 检查CHANGELOG是否需要更新
- [ ] 检查是否需要技术决策文档
- [ ] 检查i18n翻译是否完整

### 步骤4: 代码审查（10分钟）
- [ ] 创建Pull Request
- [ ] 邀请至少1位团队成员Review
- [ ] 修复所有Review意见
- [ ] 确保CI/CD通过

### 步骤5: 最终确认（2分钟）
```bash
# 1. 确认分支状态
git status

# 2. 确认提交信息规范
git log -1 --format='%s%n%b'

# 3. 确认远程同步
git fetch origin
git log origin/main -1 --oneline
```

---

## 📋 审核检查清单模板

### 快速检查清单

```markdown
## 代码质量
- [ ] ESLint: 0 errors, 0 warnings
- [ ] Prettier: 格式化完成
- [ ] TypeScript: 无类型错误
- [ ] 测试: 100% pass
- [ ] 覆盖率: ≥ 80%

## 功能完整性
- [ ] 需求: 100%实现
- [ ] 测试: 手动测试通过
- [ ] 回归: 无回归问题
- [ ] 边界: 边界条件测试通过

## 安全性
- [ ] XSS防护: 已实现
- [ ] 敏感信息: 无硬编码
- [ ] 环境变量: 正确使用
- [ ] npm audit: 0 vulnerabilities

## 文档
- [ ] 文件头: 已添加
- [ ] README: 已更新（如需要）
- [ ] CHANGELOG: 已更新
- [ ] i18n: 已添加翻译

## 性能
- [ ] 构建成功: bundle size正常
- [ ] 性能优化: 已实施
- [ ] 图片优化: 已完成

## 用户体验
- [ ] 响应式: 移动/平板/桌面通过
- [ ] 可访问性: ARIA标签完整
- [ ] 用户反馈: 加载/错误/成功提示完整

## 提交准备
- [ ] 分支: clean
- [ ] 提交信息: 符合规范
- [ ] 远程同步: 已fetch
```

---

## 🎯 提交信息规范

### 格式要求

```
<type>(<scope>): <subject>

<body>

<footer>
```

### Type类型
- **feat**: 新功能
- **fix**: 修复Bug
- **docs**: 文档更新
- **style**: 代码格式（不影响功能）
- **refactor**: 重构（不是新功能也不是修复）
- **perf**: 性能优化
- **test**: 测试相关
- **chore**: 构建过程或辅助工具变动
- **ci**: CI/CD配置变更
- **revert**: 回滚之前的commit

### Scope范围
- **settings**: 设置模块
- **agent**: AI智能体
- **ui**: UI组件
- **api**: API接口
- **i18n**: 国际化
- **perf**: 性能优化
- **security**: 安全相关

### 示例

```
feat(settings): 添加自定义滚动条样式

- 新增SettingsModal.css文件
- 添加自定义滚动条样式类
- 优化滚动视觉效果

Closes #123
```

---

## 🚫 禁止提交的情况

以下情况**绝对禁止**提交到main分支：

1. **代码无法运行**: 任何导致应用崩溃的代码
2. **测试失败**: 有未通过的测试用例
3. **类型错误**: TypeScript编译错误
4. **ESLint错误**: 有未修复的linting错误
5. **安全漏洞**: npm audit发现的高危漏洞
6. **硬编码密钥**: 代码中包含API密钥/密码
7. **缺少文档**: 复杂功能没有文档说明
8. **破坏兼容**: 导致现有功能失效
9. **性能倒退**: 显著降低应用性能
10. **用户体验差**: 严重影响用户体验的变更

---

## 📊 审核统计

### 必须通过率
- **P0审核项**: 必须 100% (25/25)
- **P1审核项**: 必须 100% (22/22)
- **P2审核项**: 建议 100% (3/3)
- **总体通过率**: 必须 100% (50/50)

### 提交前检查
```bash
# 快速检查脚本（建议保存为scripts/pre-commit-check.sh）
#!/bin/bash
set -e

echo "🔍 开始提交前审核..."

# 1. Lint检查
echo "📝 运行ESLint..."
pnpm run lint || exit 1

# 2. 类型检查
echo "🔍 运行TypeScript类型检查..."
pnpm run type-check || exit 1

# 3. 测试检查
echo "🧪 运行测试..."
pnpm run test || exit 1

# 4. 构建检查
echo "🏗️ 运行构建..."
pnpm run build || exit 1

# 5. 安全检查
echo "🔒 运行安全审计..."
npm audit --production || exit 1

echo "✅ 所有审核检查通过！"
echo "💡 请继续手动验证功能完整性..."
```

---

## 📋 审核记录模板

### 每次提交必须填写

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 YYC³ AI-Family 提交前审核记录
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📅 审核日期: 2026-02-25
👤 审核人: [姓名]
🔧 提交类型: [feat/fix/docs/refactor/etc]
📝 提交范围: [settings/agent/ui/api/etc]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔴 P0 - 强制审核项
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

代码质量 (12/12):
  [✅] 无any类型
  [✅] 命名规范
  [✅] ESLint通过
  [✅] Prettier格式化
  [✅] 单元测试
  [✅] 测试通过
  [✅] 覆盖率≥80%
  [✅] 依赖管理
  [✅] 安全扫描

功能完整性 (8/8):
  [✅] 需求对齐
  [✅] 功能测试
  [✅] 回归测试
  [✅] 边界条件
  [✅] 错误处理
  [✅] 错误提示
  [✅] 状态一致

安全性 (5/5):
  [✅] XSS防护
  [✅] 输入验证
  [✅] 无硬编码密钥
  [✅] 环境变量
  [✅] Git忽略

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🟡 P1 - 重要审核项
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

文档完整性 (6/6):
  [✅] 文件头注释
  [✅] 函数注释
  [✅] README更新
  [✅] CHANGELOG更新
  [✅] 技术文档
  [✅] i18n完整

性能 (4/4):
  [✅] 避免重渲染
  [✅] 虚拟滚动
  [✅] 懒加载
  [✅] 图片优化

用户体验 (5/5):
  [✅] 键盘导航
  [✅] ARIA标签
  [✅] 响应式设计
  [✅] 用户反馈
  [✅] 空状态

兼容性 (4/4):
  [✅] Chrome兼容
  [✅] Safari兼容
  [✅] Firefox兼容
  [✅] 移动端兼容

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🟢 P2 - 建议审核项
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

品牌一致性 (3/3):
  [✅] 视觉风格
  [✅] 色彩规范
  [✅] 品牌元素

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 审核统计
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

总计检查项: 50
通过项数: 50
通过率: 100%
审核结论: ✅ **通过，可以提交**

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💬 备注
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[添加任何特殊说明或例外情况]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 🎓 培训材料

### 新成员入职培训
所有新加入YYC³ AI-Family团队的成员必须：

1. **阅读本文档**: 完整阅读并理解审核要求
2. **实践练习**: 在非main分支练习完整审核流程
3. **导师审核**: 至少3次提交需要在导师监督下完成
4. **独立审核**: 通过考核后可独立进行审核
5. **持续改进**: 定期回顾和优化审核流程

### 常见问题解答

**Q: 紧急修复是否可以简化审核？**
A: 紧急修复可以跳过部分P2审核项，但P0和P1项必须100%通过。

**Q: 小改动是否可以减少审核？**
A: 任何改动，无论大小，必须完成P0审核。P1和P2可根据影响范围适当简化。

**Q: 审核发现问题如何处理？**
A: 必须修复所有问题后方可提交。如遇到困难，及时寻求团队协助。

**Q: 审核时间不够怎么办？**
A: 建议预留至少30分钟用于审核。如时间紧张，优先完成P0审核。

---

<div align="center">

**YYC³ AI-Family**

*言启象限 | 语枢未来*

**质量第一 · 审核严格 · 持续改进*

---

*文档版本: 1.0.0*
*最后更新: 2026-02-25*
*维护者: YYC³ Team*

</div>
