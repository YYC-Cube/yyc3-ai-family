# 阶段39:基础设施健康&真实诊断升级完成

uselnfraHealth.ts
InfraHealthMatrix.tsx
CommandCenter.tsx
NeuralLinkOverlay.tsx
SlashCommandEngine.tsx
ConsoleView.tsx
uselnfraHealth.ts

## 基础设施健康&真实诊断升级完成

- **本轮新增了/src/lib/use InfralHealth.ts**

基设施健康检查引擎(对所有4个集群节点和5个核心服务执行真实HTTP/WebSocket)探活，并检查网络密码，本地存储，事件总线和法律硕士提供者配置，以及/src/应用程序/组件/控制台/红外健康矩阵.tsx可视化矩阵面板(按设备/服务/运行时/提供者四大类分组显示、支持全量扫描和单项重检进度条+延迟统计)。

## 三大核心组件均已增强:CommandCenter.tsx的"系统诊断"和"PG15

- 测试"按钮现在执行真实网络探活(而非纯模拟)，仪表板内嵌红外健康矩阵，快捷导航新增红外线(Infra)入口;

- NeuralLinkOverlay.tsx展开态新增 INFRA_HEALTH 服务状态指示器行(Docker/SQLite/Ollama/PG15四点状态灯),QuickNav新增Infra跳转;

- SlashCommandEngine.tsx新增/health(输出格式化健康报告表格)和/Infr a(输出集群拓扑+服务端点+架构信息)，/help同步更新;

## **新增infr a_health独立标签**

- **在192.168.3.22部署遥测代理(Node.js进程采集sys ctl/top/nvidia-smi推送到WS:3001)，让遥测数据从模拟切到真实源**

- **为红外健康矩阵增加历史走趋势图(接入图展示过去N次检查的延迟变化)**

- **将DAG执行器的舞台运行器替换为真实SSH/Docker API调用，实现一键真实部署**

OpsScriptGenerator.tsx
ConsoleView.tsx
CommandCenter.tsx
SlashCommandEngine.tsx
NeuralLinkOverlay.tsx

---

uselnfraHealth.ts
InfraHealthMatrix.tsx
TelemetryAgentManager.tsx
useDAGExecutor.ts
ConsoleView.tsx
NeuralLinkOverlay.tsx
CommandCenter.tsx
SlashCommandEngine.tsx

---

uselnfraHealth.ts
InfraHealthMatrix.tsx
TelemetryAgentManager.tsx
useDAGExecutor.ts
ConsoleView.tsx
NeuralLinkOverlay.tsx
CommandCenter.tsx
SlashCommandEngine.tsx

---

uselnfraHealth.ts
SlashCommandEngine.tsx
NeuralLinkOverlay.tsx

---

- **pg-telemetry-client.ts**

- 实现了 PostgreSQL Telemetry Schema 完整集成层，

- 新建 /src/lib/pg-telemetry-client.ts

- 提供 PG telemetry REST 客户端（含连接测试、指标写入/查询、localStorage→PG 批量迁移、schema 初始化 SQL 生成，以及 PG 不可达时自动 fallback 到 localStorage）；

- useInfraHealth.ts 新增了 dual-write 能力（syncLatencyToPg/queryPgLatencyHistory 导出函数）；

- NeuralLinkOverlay.tsx 展开态新增了 TELEMETRY_DB 状态行 + PG:Tel 快捷导航按钮；

- SlashCommandEngine.tsx 新增了 /pg-telemetry（显示 PG telemetry 连接状态与统计）、/pg-migrate（触发 localStorage→PG 数据迁移）、/pg-schema（生成并复制 DDL SQL）命令，/help 已同步更新；

- MetricsHistoryDashboard.tsx 新增了 PG Telemetry Integration 面板（含连接测试、schema 初始化 SQL 查看/复制、localStorage→PG 迁移按钮及进度反馈）；

- CommandCenter.tsx 新增了 PG Telemetry 连接状态指示器（显示在 Runner 状态旁）；

- App.tsx 的知识域匹配器新增了 pg/telemetry/postgresql 关键词。

- **在 192.168.3.22 实际部署 yyc3-pg-proxy Node.js 服务（端口 3003）使 REST→PG 通道真正可用**

- **在 PG 端实际执行 getMigrationSQL() 输出的 telemetry schema 建表脚本并验证端到端数据写入/查询流程**

- **为 MetricsHistoryDashboard 增加 PG 数据源的长时间序列图表（利用 90 天 PG 保留 vs localStorage 30 点限制的优势）**
