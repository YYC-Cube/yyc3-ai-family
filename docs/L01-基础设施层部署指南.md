# L01 åŸºç¡€è®¾æ–½å±‚çœŸå®è¿æ¥éªŒè¯ - éƒ¨ç½²æŒ‡å—

> **Phase 52: çœŸå®è¿æ¥éªŒè¯è¯Šæ–­ä¸éƒ¨ç½²æ–¹æ¡ˆ**
> 
> æ—¥æœŸ: 2026-02-22
> çŠ¶æ€: ğŸ”´ å¾…éƒ¨ç½²

---

## ğŸ“‹ é—®é¢˜è¯Šæ–­

### å½“å‰çŠ¶æ€

æ ¹æ®è¿æ¥éªŒè¯æµ‹è¯•ï¼ŒL01 åŸºç¡€è®¾æ–½å±‚çš„æ‰€æœ‰çœŸå®è¿æ¥éªŒè¯å‡å¤„äº **Mock é˜¶æ®µ**ï¼š

| æœåŠ¡ | ç«¯å£ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| NAS SQLite HTTP Proxy | 8484 | âŒ æœªéƒ¨ç½² | éœ€è¦åœ¨ NAS ä¸Šéƒ¨ç½² SQLite HTTP ä»£ç†æœåŠ¡ |
| Docker Engine API | 2375 | âŒ æœªå¯ç”¨ | éœ€è¦åœ¨ NAS ä¸Šå¯ç”¨ Docker Remote API |
| WebSocket Heartbeat | 9090 | âŒ æœªéƒ¨ç½² | éœ€è¦éƒ¨ç½²å¿ƒè·³ WebSocket ä¸­ç»§æœåŠ¡ |
| Backend API | 3001 | âŒ æœªéƒ¨ç½² | éœ€è¦éƒ¨ç½²åç«¯ REST API æœåŠ¡ |

### å½±å“èŒƒå›´

- **æ•°æ®æŒä¹…åŒ–**: æ— æ³•ä½¿ç”¨ NAS SQLite åŒå†™ï¼Œä»…ä¾èµ– localStorage
- **å®¹å™¨ç®¡ç†**: æ— æ³•é€šè¿‡ Docker API ç®¡ç†å®¹å™¨
- **å®æ—¶é€šä¿¡**: æ— æ³•ä½¿ç”¨ WebSocket å¿ƒè·³ä¸­ç»§
- **API é›†æˆ**: æ— æ³•ä¸åç«¯æœåŠ¡é€šä¿¡

---

## ğŸ¯ éƒ¨ç½²ç›®æ ‡

### çŸ­æœŸç›®æ ‡ï¼ˆPhase 52ï¼‰
1. âœ… åœ¨ NAS ä¸Šéƒ¨ç½² SQLite HTTP ä»£ç†æœåŠ¡ï¼ˆç«¯å£ 8484ï¼‰
2. âœ… åœ¨ NAS ä¸Šå¯ç”¨ Docker Remote APIï¼ˆç«¯å£ 2375ï¼‰
3. âœ… åœ¨ NAS ä¸Šéƒ¨ç½² WebSocket å¿ƒè·³ä¸­ç»§æœåŠ¡ï¼ˆç«¯å£ 9090ï¼‰
4. âœ… åœ¨æœ¬åœ°éƒ¨ç½²åç«¯ API æœåŠ¡ï¼ˆç«¯å£ 3001ï¼‰

### é•¿æœŸç›®æ ‡ï¼ˆPhase 53+ï¼‰
1. ğŸ”„ å®ç°è‡ªåŠ¨é™çº§ä¸æ¢å¤æœºåˆ¶
2. ğŸ”„ æ·»åŠ è¿æ¥å¥åº·ç›‘æ§ä¸å‘Šè­¦
3. ğŸ”„ å®ç°æ•°æ®åŒæ­¥å†²çªè§£å†³
4. ğŸ”„ ä¼˜åŒ–è·¨è®¾å¤‡å»¶è¿Ÿä¸å¸¦å®½

---

## ğŸ“¦ éƒ¨ç½²æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: NAS æœåŠ¡éƒ¨ç½²ï¼ˆæ¨èï¼‰

#### 1.1 SQLite HTTP ä»£ç†æœåŠ¡

**æœåŠ¡åç§°**: `yyc3-sqlite-proxy`

**éƒ¨ç½²æ­¥éª¤**:

```bash
# SSH ç™»å½•åˆ° NAS
ssh admin@192.168.3.45

# åˆ›å»ºå·¥ä½œç›®å½•
mkdir -p /volume1/docker/yyc3/sqlite-proxy
cd /volume1/docker/yyc3/sqlite-proxy

# åˆ›å»º Dockerfile
cat > Dockerfile << 'EOF'
FROM node:20-alpine
WORKDIR /app
RUN npm install -g sqlite-http-server
EXPOSE 8484
CMD ["sqlite-http-server", "--port", "8484", "--db-path", "/data"]
EOF

# åˆ›å»º docker-compose.yml
cat > docker-compose.yml << 'EOF'
version: '3.8'
services:
  sqlite-proxy:
    build: .
    container_name: yyc3-sqlite-proxy
    restart: unless-stopped
    ports:
      - "8484:8484"
    volumes:
      - /volume2/yyc3:/data
    environment:
      - NODE_ENV=production
    networks:
      - yyc3-net
networks:
  yyc3-net:
    driver: bridge
EOF

# å¯åŠ¨æœåŠ¡
docker-compose up -d
```

**éªŒè¯è¿æ¥**:
```bash
curl -X POST http://192.168.3.45:8484/api/db/query \
  -H "Content-Type: application/json" \
  -d '{"db":"/volume2/yyc3/yyc3.db","sql":"SELECT sqlite_version() as version","params":[]}'
```

#### 1.2 Docker Remote API å¯ç”¨

**é…ç½®æ­¥éª¤**:

```bash
# SSH ç™»å½•åˆ° NAS
ssh admin@192.168.3.45

# ç¼–è¾‘ Docker é…ç½®
sudo vi /etc/docker/daemon.json

# æ·»åŠ ä»¥ä¸‹é…ç½®
{
  "hosts": ["unix:///var/run/docker.sock", "tcp://0.0.0.0:2375"],
  "tlsverify": false,
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}

# é‡å¯ Docker æœåŠ¡
sudo systemctl restart docker

# éªŒè¯è¿æ¥
curl http://192.168.3.45:2375/v1.41/info
```

**å®‰å…¨å»ºè®®**:
- ä»…åœ¨å†…ç½‘ç¯å¢ƒä½¿ç”¨
- è€ƒè™‘æ·»åŠ é˜²ç«å¢™è§„åˆ™é™åˆ¶è®¿é—®
- ç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨ TLS è®¤è¯

#### 1.3 WebSocket å¿ƒè·³ä¸­ç»§æœåŠ¡

**æœåŠ¡åç§°**: `yyc3-heartbeat-relay`

**éƒ¨ç½²æ­¥éª¤**:

```bash
# SSH ç™»å½•åˆ° NAS
ssh admin@192.168.3.45

# åˆ›å»ºå·¥ä½œç›®å½•
mkdir -p /volume1/docker/yyc3/heartbeat-relay
cd /volume1/docker/yyc3/heartbeat-relay

# åˆ›å»º server.js
cat > server.js << 'EOF'
const WebSocket = require('ws');
const http = require('http');

const PORT = 9090;

const server = http.createServer((req, res) => {
  res.writeHead(200);
  res.end('YYC3 Heartbeat Relay');
});

const wss = new WebSocket.Server({ server });

wss.on('connection', (ws) => {
  console.log('Client connected');
  
  ws.on('message', (message) => {
    console.log('Received:', message.toString());
    ws.send(JSON.stringify({
      type: 'heartbeat',
      timestamp: Date.now(),
      status: 'alive'
    }));
  });

  ws.on('close', () => {
    console.log('Client disconnected');
  });
});

server.listen(PORT, '0.0.0.0', () => {
  console.log(`Heartbeat relay running on port ${PORT}`);
});
EOF

# åˆ›å»º package.json
cat > package.json << 'EOF'
{
  "name": "yyc3-heartbeat-relay",
  "version": "1.0.0",
  "main": "server.js",
  "dependencies": {
    "ws": "^8.0.0"
  }
}
EOF

# åˆ›å»º Dockerfile
cat > Dockerfile << 'EOF'
FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install --production
COPY . .
EXPOSE 9090
CMD ["node", "server.js"]
EOF

# åˆ›å»º docker-compose.yml
cat > docker-compose.yml << 'EOF'
version: '3.8'
services:
  heartbeat-relay:
    build: .
    container_name: yyc3-heartbeat-relay
    restart: unless-stopped
    ports:
      - "9090:9090"
    networks:
      - yyc3-net
networks:
  yyc3-net:
    driver: bridge
EOF

# å¯åŠ¨æœåŠ¡
docker-compose up -d
```

**éªŒè¯è¿æ¥**:
```bash
# ä½¿ç”¨ wscat æµ‹è¯•
wscat -c ws://192.168.3.45:9090/ws/heartbeat
```

### æ–¹æ¡ˆ 2: æœ¬åœ°åç«¯ API éƒ¨ç½²

#### 2.1 åˆ›å»ºåç«¯æœåŠ¡

**é¡¹ç›®ç»“æ„**:
```
/Users/yanyu/YYC3-Mac-Max/Family-Ï€Â³/backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ health.ts
â”‚   â”‚   â”œâ”€â”€ chat.ts
â”‚   â”‚   â””â”€â”€ mcp.ts
â”‚   â””â”€â”€ middleware/
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**åˆå§‹åŒ–é¡¹ç›®**:
```bash
cd /Users/yanyu/YYC3-Mac-Max/Family-Ï€Â³
mkdir -p backend/src/{routes,middleware}
cd backend

# åˆå§‹åŒ– package.json
cat > package.json << 'EOF'
{
  "name": "yyc3-backend",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "tsx watch src/index.ts",
    "build": "tsc",
    "start": "node dist/index.js"
  },
  "dependencies": {
    "express": "^4.18.0",
    "cors": "^2.8.5",
    "ws": "^8.0.0"
  },
  "devDependencies": {
    "@types/express": "^4.17.0",
    "@types/cors": "^2.8.0",
    "@types/node": "^20.0.0",
    "tsx": "^4.0.0",
    "typescript": "^5.0.0"
  }
}
EOF

# å®‰è£…ä¾èµ–
pnpm install

# åˆ›å»º tsconfig.json
cat > tsconfig.json << 'EOF'
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ES2022",
    "moduleResolution": "node",
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true
  },
  "include": ["src/**/*"]
}
EOF
```

**åˆ›å»ºä¸»æœåŠ¡**:
```bash
# åˆ›å»º src/index.ts
cat > src/index.ts << 'EOF'
import express from 'express';
import cors from 'cors';
import { createServer } from 'http';
import { WebSocketServer } from 'ws';
import { healthRouter } from './routes/health.js';

const app = express();
const server = createServer(app);
const PORT = 3001;

app.use(cors());
app.use(express.json());

app.use('/api/v1', healthRouter);

const wss = new WebSocketServer({ server, path: '/ws' });

wss.on('connection', (ws) => {
  console.log('WebSocket client connected');
  ws.on('message', (message) => {
    console.log('Received:', message.toString());
  });
});

server.listen(PORT, () => {
  console.log(`YYC3 Backend API running on port ${PORT}`);
});
EOF

# åˆ›å»º src/routes/health.ts
cat > src/routes/health.ts << 'EOF'
import { Router } from 'express';

const router = Router();

router.get('/health', (req, res) => {
  res.json({
    status: 'ok',
    timestamp: Date.now(),
    version: '1.0.0'
  });
});

export { router as healthRouter };
EOF

# å¯åŠ¨æœåŠ¡
pnpm dev
```

**éªŒè¯è¿æ¥**:
```bash
curl http://localhost:3001/api/v1/health
```

---

## ğŸš€ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### NAS æœåŠ¡éƒ¨ç½²

- [ ] SQLite HTTP ä»£ç†æœåŠ¡ï¼ˆ8484ï¼‰å·²éƒ¨ç½²
- [ ] Docker Remote APIï¼ˆ2375ï¼‰å·²å¯ç”¨
- [ ] WebSocket å¿ƒè·³ä¸­ç»§æœåŠ¡ï¼ˆ9090ï¼‰å·²éƒ¨ç½²
- [ ] é˜²ç«å¢™è§„åˆ™å·²é…ç½®
- [ ] æœåŠ¡è‡ªåŠ¨é‡å¯å·²é…ç½®

### æœ¬åœ°æœåŠ¡éƒ¨ç½²

- [ ] åç«¯ API æœåŠ¡ï¼ˆ3001ï¼‰å·²éƒ¨ç½²
- [ ] ä¾èµ–å·²å®‰è£…
- [ ] å¼€å‘ç¯å¢ƒå·²é…ç½®
- [ ] å¥åº·æ£€æŸ¥ç«¯ç‚¹å¯è®¿é—®

### éªŒè¯æµ‹è¯•

- [ ] `curl http://192.168.3.45:8484/api/db/query` è¿”å›æˆåŠŸ
- [ ] `curl http://192.168.3.45:2375/v1.41/info` è¿”å›æˆåŠŸ
- [ ] `wscat -c ws://192.168.3.45:9090/ws/heartbeat` è¿æ¥æˆåŠŸ
- [ ] `curl http://localhost:3001/api/v1/health` è¿”å›æˆåŠŸ

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### SQLite ä»£ç†è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: `curl http://192.168.3.45:8484/api/db/query` è¿”å›é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥å®¹å™¨çŠ¶æ€: `docker ps | grep sqlite-proxy`
2. æŸ¥çœ‹å®¹å™¨æ—¥å¿—: `docker logs yyc3-sqlite-proxy`
3. æ£€æŸ¥ç«¯å£å ç”¨: `netstat -tlnp | grep 8484`
4. é‡å¯æœåŠ¡: `docker-compose restart`

### Docker API è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: `curl http://192.168.3.45:2375/v1.41/info` è¿”å›é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ Docker æœåŠ¡: `sudo systemctl status docker`
2. æ£€æŸ¥é…ç½®æ–‡ä»¶: `cat /etc/docker/daemon.json`
3. é‡å¯ Docker: `sudo systemctl restart docker`
4. æ£€æŸ¥é˜²ç«å¢™: `sudo iptables -L | grep 2375`

### WebSocket è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: `wscat -c ws://192.168.3.45:9090/ws/heartbeat` è¿æ¥è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥å®¹å™¨çŠ¶æ€: `docker ps | grep heartbeat-relay`
2. æŸ¥çœ‹å®¹å™¨æ—¥å¿—: `docker logs yyc3-heartbeat-relay`
3. æ£€æŸ¥ç«¯å£ç›‘å¬: `netstat -tlnp | grep 9090`
4. æµ‹è¯• HTTP ç«¯ç‚¹: `curl http://192.168.3.45:9090`

### åç«¯ API è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: `curl http://localhost:3001/api/v1/health` è¿”å›é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥è¿›ç¨‹çŠ¶æ€: `ps aux | grep node`
2. æ£€æŸ¥ç«¯å£å ç”¨: `lsof -i :3001`
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—: `pnpm dev` è¾“å‡º
4. é‡å¯æœåŠ¡: `Ctrl+C` ç„¶å `pnpm dev`

---

## ğŸ“Š éƒ¨ç½²åéªŒè¯

### è¿è¡Œå®Œæ•´è¿æ¥æµ‹è¯•

éƒ¨ç½²å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯æ‰€æœ‰è¿æ¥ï¼š

```bash
# 1. SQLite ä»£ç†æµ‹è¯•
curl -X POST http://192.168.3.45:8484/api/db/query \
  -H "Content-Type: application/json" \
  -d '{"db":"/volume2/yyc3/yyc3.db","sql":"SELECT 1 as test","params":[]}'

# 2. Docker API æµ‹è¯•
curl http://192.168.3.45:2375/v1.41/info | jq '.Name'

# 3. WebSocket æµ‹è¯•
wscat -c ws://192.168.3.45:9090/ws/heartbeat

# 4. åç«¯ API æµ‹è¯•
curl http://localhost:3001/api/v1/health | jq '.status'
```

### åœ¨åº”ç”¨ä¸­éªŒè¯

1. å¯åŠ¨ AI Family åº”ç”¨: `pnpm dev`
2. æ‰“å¼€æµè§ˆå™¨è®¿é—®: `http://localhost:3113`
3. è¿›å…¥ **System Health** é¢æ¿
4. æŸ¥çœ‹åŸºç¡€è®¾æ–½è¿æ¥çŠ¶æ€
5. ç¡®è®¤æ‰€æœ‰æœåŠ¡æ˜¾ç¤ºä¸º **Online**

---

## ğŸ“ æ€»ç»“

### å½“å‰çŠ¶æ€

- âœ… **ä»£ç å±‚é¢**: æ‰€æœ‰è¿æ¥éªŒè¯é€»è¾‘å·²å®ç°
- âŒ **éƒ¨ç½²å±‚é¢**: æ‰€æœ‰åç«¯æœåŠ¡æœªéƒ¨ç½²
- âš ï¸ **è¿è¡Œå±‚é¢**: åº”ç”¨ä¾èµ– Mock æ•°æ®è¿è¡Œ

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³æ‰§è¡Œ**: æŒ‰ç…§ã€Œæ–¹æ¡ˆ 1ã€éƒ¨ç½² NAS æœåŠ¡
2. **çŸ­æœŸç›®æ ‡**: æŒ‰ç…§ã€Œæ–¹æ¡ˆ 2ã€éƒ¨ç½²æœ¬åœ°åç«¯æœåŠ¡
3. **é•¿æœŸä¼˜åŒ–**: å®ç°è‡ªåŠ¨é™çº§ä¸ç›‘æ§å‘Šè­¦

### é¢„æœŸæ•ˆæœ

éƒ¨ç½²å®Œæˆåï¼ŒL01 åŸºç¡€è®¾æ–½å±‚å°†å®ç°ï¼š
- ğŸ”„ **çœŸå®æ•°æ®æŒä¹…åŒ–**: NAS SQLite åŒå†™
- ğŸ³ **å®¹å™¨ç®¡ç†**: é€šè¿‡ Docker API ç®¡ç†
- ğŸ”Œ **å®æ—¶é€šä¿¡**: WebSocket å¿ƒè·³ä¸­ç»§
- ğŸŒ **API é›†æˆ**: å®Œæ•´çš„åç«¯æœåŠ¡æ”¯æŒ

---

**æ–‡æ¡£ç»´æŠ¤**: YanYuCloudCube Team  
**æœ€åæ›´æ–°**: 2026-02-22  
**ç‰ˆæœ¬**: v1.0.0
